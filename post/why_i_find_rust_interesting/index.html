<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="" name="keywords">
<meta content="Robert Vally" name="author">
<meta property="og:title" content="Why I find Rust interesting">
<meta property="og:url" content="https://shiver.github.io/post/why_i_find_rust_interesting/">
<meta property="og:description" content="Initially, I planned for this to be an introduction to the Rust programming language for colleagues at work. However, when looking around online for inspiration, I noticed that one thing there was no shortage of, were Rust introductions. So with that in mind, I thought I would instead focus why I personally find the language interesting.
So I won&rsquo;t be teaching you how to write Rust. I won&rsquo;t be giving an overview of the language syntax, or its type system.">
<meta property="og:type" content="website" />
<title>Why I find Rust interesting | Learn Everything</title>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Karla:wght@300;400;800&display=swap" rel="stylesheet">


<link rel="shortcut icon" href="https://shiver.github.io//favicon.ico">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/base16/gruvbox-dark-hard.min.css">


<link rel="stylesheet" href="https://shiver.github.io//css/style.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://shiver.github.io/"><h1 class="back is-4">ðŸ¡ </h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level">
          
          <a class="level-item" href="https://github.com/shiver" target="_blank">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/shivernz" target="_blank">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml" target="_blank">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">Why I find Rust interesting</h1>
    <h2 class="subtitle">March 24, 2023 by Robert Vally</h2>
    
      <div class="tags">
    
        <a class="is-link" href="/tags/rust">rust</a>
    
</div>

    
    <hr>
    <div class="content">
      <p>Initially, I planned for this to be an introduction to the Rust programming language for colleagues at work. However, when looking around online for inspiration, I noticed that one thing there was no shortage of, were Rust introductions. So with that in mind, I thought I would instead focus why I personally find the language interesting.</p>
<p>So I won&rsquo;t be teaching you how to write Rust. I won&rsquo;t be giving an overview of the language syntax, or its type system. I won&rsquo;t be showing you its tooling, or some interesting projects that have been created using the language. And I definitely won&rsquo;t be trying to convince you to rewrite everything in Rust.</p>
<p>There are already countless videos and articles online which cover these topics, most of which likely do at least a semi-decent job of the task. So if you find your interest piqued at all throughout the duration of this article, then I would encourage you to seek them out, once you&rsquo;re done reading this one of course!</p>
<p>Instead, my goal today is to try and explain why Rust is both unique and interesting, and why I think you should at least give it a try.</p>
<p>Even if you don&rsquo;t end up using the language long term, much like learning Haskell or C, you&rsquo;ll potentially take at least some learnings from it, which can then applied to projects you tackle in the future.</p>
<h2 id="there-will-be-lies--assembly">There will be lies &amp; assembly</h2>
<p>I will be glossing over quite a bit of detail throughout this article. There are exceptions to every rule and given the scope of the concepts I will be trying to cover, I won&rsquo;t be able to describe everything in extreme detail. Hopefully I will still be able to at least get the important points across though.</p>
<p>There will also be a bit of assembly. Only a small amount though. Just enough to show you how something <em>actually</em> works.</p>
<p>I will do my best to try and simplify it, but as long as you have a grasp of some general programming concepts, you should be fine. Assembly is actually a fairly simple language, and it is mostly the things not expressed in the language itself that can make reading it a bit confusing at times.</p>
<h2 id="first-a-bit-of-background">First a bit of background&hellip;</h2>
<p>To appreciate what makes Rust interesting, you&rsquo;ll first need to have at least a rough understanding of a few concepts you have most likely come across before. However, since I am not sure just <em>how much</em> you know, you&rsquo;ll have to excuse me while I tread over old ground.</p>
<p>Also, if your background is mostly in managed languages like Typescript, Python or C#, then it could be difficult to see what makes Rust different besides some extra warnings given to you by the compiler, especially given that the syntax of the language will tend to look pretty familiar for the most part.</p>
<p>So to be sure that we all start off on roughly the same page, I&rsquo;ll briefly go over how programs work in regards to memory. Discussing the stack, the heap and garbage collectors. And most importantly, how Rust manages to get by without one, while still allowing you to work in much the same manner.</p>
<p><img src="/why_i_find_rust_interesting/program-memory-layout.png" alt="Program memory layout"></p>
<p>To start, this is a fairly common diagram you&rsquo;ll see floating around the internet which just illustrates the layout of your program once it is loaded into memory.</p>
<p>You can see at the bottom we have the <code>text</code> section, which holds the machine code instructions the CPU will be running. This is the code you&rsquo;ve written, after being converted into something the CPU can understand.</p>
<p>But what we&rsquo;re interested in for now though are the stack and the heap.</p>
<h2 id="what-is-the-stack">What is the stack?</h2>
<ul>
<li>Allocated from RAM (typically ~1MB - 8MB)</li>
<li>Requested by and assigned to each thread</li>
<li>Minimal management overhead (LIFO)</li>
<li>Allocated in one contiguous block (usually)</li>
<li>Managed for you by your compiler</li>
<li>Data on the stack is more likely to be in the cache*</li>
</ul>
<p>As we saw in the previous image, the stack is stored in RAM.</p>
<p>It is a common misconception that the stack is actually stored somewhere else, perhaps even on the CPU, however this is not the case. Like most things, it is also allocated from RAM.</p>
<p>Each stack instance is typically allocated in one contiguous block. Each block is then assigned to a thread. So if you have an application which is using four threads, you&rsquo;ll have four separate stacks. Obviously if you don&rsquo;t have multiple threads, you&rsquo;ll just get the one.</p>
<p>The stack is typically allocated just the once at the start of each new thread. This memory is only handed back to the OS at the end of the thread&rsquo;s lifetime, or when your program exits. The advantage here being that it won&rsquo;t need to make any additional calls to the OS to request more space. Just the one allocation for the lifetime the thread.</p>
<p>Management of the stack is done using an extremely simple last-in, first-out data structure. This means that the last thing you push onto the stack is the first thing that will be removed. We&rsquo;ll see an example of this shortly which will hopefully explain things a bit better.</p>
<p>The size of the stack is greatly dependent on your OS, hardware and programming language. And while some languages or operating systems do provide mechanisms to expand the size of the stack at runtime, there are limits, and this is usually not a done thing. So under almost all circumstances you should expect this to remain at a fixed size for the duration of your program.</p>
<p>One important aspect of the stack is that the CPU has more than likely recently accessed your data in order to place it on the stack, so it is also just as likely that the data will be in the CPU cache. Having your data in the cache will usually result in significant performance improvements. Depending on what you&rsquo;re doing with that data of course. Mostly importantly the cache is significantly faster than normal memory, as it is situated on the CPU itself. So it doesn&rsquo;t operate under the same latencies that normal RAM does.</p>
<h2 id="what-is-the-stack-used-for">What is the stack used for</h2>
<p>One of the primary purposes of the stack is to facilitate function calls.</p>
<p>More specifically, this is where function parameters are prepared before calling the function itself. It is also responsible for holding the function return address, which is the location where the program will jump to once the function ends. The stack is also responsible for holding onto temporary values that only live for the duration of the function.</p>
<p>That was a lot of information to parse, so it might help to see what this looks like in practice.</p>
<h2 id="how-the-stack-works">How the stack works</h2>
<p><img src="/why_i_find_rust_interesting/how-the-stack-works.png" alt="How the stack works"></p>
<p>What you see here is just a quick illustration of what the stack might look like for a simple function <code>main</code> that calls another function and then exits.</p>
<p>We start off entering the main function where the stack is empty. We then allocate a small amount of space for a local variable. For example, assigning the integer value <code>1</code> to a variable called <code>a</code>.</p>
<p>After that you can see we are allocating more space to prepare to make a call to a function, allocating space for two function parameters.</p>
<p>Once inside the function, we allocate a further chunk to hold a variable local to the nested function. When the function is done, just before returning, we free our stack space. So when we return to the previous function, things are as we left it.</p>
<p>Finally, we leave the main function and the remaining memory is &ldquo;freed&rdquo;.</p>
<p><em>Note: This section has some of those <strong>lies</strong> I was talking about earlier. There are registers involved in this process too, and quite often it won&rsquo;t work in exactly this manner, but it illustrates the point so we&rsquo;ll just leave it at that and move on!</em></p>
<h2 id="what-it-_actually_-looks-like">What it <em>actually</em> looks like</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> numbers[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>};
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is a C program that assigns an array of five integers to the variable <code>numbers</code>. Lets take a look at a bit of assembly to see how this is represented.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#a6e22e">Allocating</span> <span style="color:#66d9ef">space</span> <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">x</span> <span style="color:#ae81ff">32</span><span style="color:#66d9ef">bit</span> <span style="color:#66d9ef">values</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">20</span> <span style="color:#66d9ef">bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">20</span>              <span style="color:#960050;background-color:#1e0010">&lt;</span>--- <span style="color:#66d9ef">Allocation</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span>[<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">1</span>    <span style="color:#960050;background-color:#1e0010">&lt;</span>--- <span style="color:#66d9ef">Assignment</span>, <span style="color:#66d9ef">increasing</span> <span style="color:#66d9ef">by</span> <span style="color:#ae81ff">4</span> <span style="color:#66d9ef">bytes</span> <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">each</span> <span style="color:#66d9ef">value</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span>[<span style="color:#66d9ef">rsp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">4</span>], <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span>[<span style="color:#66d9ef">rsp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">8</span>], <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span>[<span style="color:#66d9ef">rsp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">12</span>], <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span>[<span style="color:#66d9ef">rsp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">16</span>], <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">20</span>              <span style="color:#960050;background-color:#1e0010">&lt;</span>--- <span style="color:#66d9ef">Release</span>
</span></span></code></pre></div><p>Potentially a bit mystifying looking if you&rsquo;ve never looked at assembly before, but it is really quite simple.</p>
<p><code>sub</code> is the instruction to &ldquo;subtract&rdquo; and <code>rsp</code> refers to the &ldquo;stack pointer&rdquo;. So we have an instruction that is subtracting <code>20 bytes</code> from the available stack space. This is all we need to do to allocate the space to hold our array of five 32bit integers.</p>
<p>The next five lines copy the values into their respective locations on the stack. You can see we are adding four to the stack pointer each time. 4 bytes for every 32bit integer.</p>
<p>The only real important thing to note here is that both the allocation and the release of the space are achieved in single CPU instructions.</p>
<p>This is why the stack is fast, and this is why it usually a place you want to have your data when the CPU is doing work.</p>
<p>It is worth stressing that we are not technically allocating, or freeing new chunks of memory here. Instead we are simply changing the spot we&rsquo;re pointing to in a large chunk of memory that has already been allocated.</p>
<h2 id="what-is-the-heap">What is the heap</h2>
<p>Now let&rsquo;s take a look at the heap.</p>
<p>Unlike the stack, the heap is allocated dynamically at runtime. However, much like the stack, it is also stored in RAM. The main benefit of the heap though is its ability to grow to fit whatever you need as long as you have enough physical RAM to support it.</p>
<p>More importantly the heap is made up of a number of randomly sized small chunks of memory. It is this trait that sets it apart the most from the stack with its single contiguous block. Having its allocations spread around requires a lot of bookkeeping. It needs to keep track of which blocks are used, which have been freed and how much space is still available. It is this management overhead that causes the heap to often be quite a bit slower than the stack, especially for applications which make a large number of allocations at runtime.</p>
<p>Also, the heap can become fragmented over time. As each chunk is freed, it potentially leaves a small gap that may be too small to fit another allocation, effectively rendering the block unusable and akin to a memory leak.</p>
<p>Your OS will employ some techniques that will attempt to deal with these sorts of issues, but this means that each time you request or free a block of memory on the heap, you&rsquo;re potentially incurring some management overhead, and wasting CPU cycles doing administrative work instead of the work you actually want it to do.</p>
<p>It is important to note that unlike the stack, the memory you request from the heap needs to be freed by you, the programmer. Perhaps more commonly these days, the garbage collector.</p>
<h2 id="what-is-the-heap-used-for">What is the heap used for</h2>
<p>So what is the heap used for?</p>
<p>Put simply:</p>
<ul>
<li>Data that either needs to live longer than the scope of a function</li>
<li>When you don&rsquo;t know how much space you&rsquo;ll need until runtime</li>
<li>Data that exceeds the size limit of the space available to the stack</li>
</ul>
<h2 id="how-the-heap-works">How the heap works</h2>
<p><img src="/why_i_find_rust_interesting/how-the-heap-works.png" alt="How the heap works"></p>
<p>This is an overview of what your system memory might look like when running your program.</p>
<p>You&rsquo;ll notice the single large block holding our stack. Then we have a number of other randomly sized allocations littered about. These might be ours, but they could also be from another program entirely. Which blocks you get is completely up to the OS.</p>
<p>If you take a look at the bottom left, you can see some data being copied from the stack to the heap. In the center image we&rsquo;ve allocated some space from the available pool, which now holds our data.</p>
<p>In the image at the bottom we can see what it looks like when a number of chunks have been released back to the OS, illustrating what memory fragmentation looks like.</p>
<h2 id="what-it-_actually_-looks-like-1">What it <em>actually</em> looks like</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> values[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">heap</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> numbers <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span>)malloc(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span> LEN(values));
</span></span><span style="display:flex;"><span>	memcpy(numbers, values, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span> LEN(values));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Once again, this is a little bit of C code.</p>
<p>It is not important for you to be able to read it, you only need to understand that it does mostly what we did in the previous example I showed, where we had some values stored on the stack. However, this time around, much like the diagram in the previous slide, we are taking the data stored on the stack and copying into the heap.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> values[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">heap</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> numbers <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span>)malloc(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span> LEN(values));
</span></span><span style="display:flex;"><span>	memcpy(numbers, values, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span> LEN(values));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sub</span> Â  Â  <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rbp-4</span>], <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rbp-4</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">call</span> Â  Â <span style="color:#66d9ef">malloc</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rbp-16</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rbp-16</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">esi</span>, <span style="color:#66d9ef">OFFSET</span> <span style="color:#66d9ef">FLAT</span>:<span style="color:#66d9ef">values</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> Â  Â  <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">call</span> Â  Â <span style="color:#66d9ef">memcpy</span>
</span></span></code></pre></div><p>And here is the assembly for that.</p>
<p>Firstly, we allocate a bit of stack space for the operations we&rsquo;ll need to perform in this function totalling 16 bytes. We then load the length of our array onto the stack and execution a few more instructions to setup the data required before we make our call to <code>malloc</code>.</p>
<p>Out of that comes our address to the block of memory we&rsquo;ve been given, stored in the <code>rax</code> register. We then use that bit of information to copy our values onto the heap by calling <code>memcpy</code>. If you&rsquo;ve used C at all, you should definitely be familiar with these two functions.</p>
<p>Importantly you won&rsquo;t see any reference to the heap memory being deallocated here. This is something we&rsquo;ll need to call manually at some point in our program. At the moment we have a memory leak.</p>
<p>I would like you to note the call to <code>malloc</code> here though, and urge you to take a look at its <a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=76c50e3f581771d0d14552eb13b3d7bbd7d4b922;hb=HEAD">glibc</a> implementation in your own time. This is likely what your program will use when requesting memory from the OS on Linux based machines.</p>
<p>A quick summary though:</p>
<ul>
<li>40 functions</li>
<li>20 data structures</li>
<li>multiple source files</li>
<li>approximately 20,000 lines of C code</li>
</ul>
<p>When I mentioned that allocating memory on the heap was complicated and had a fair amount of administrative overhead. This is what I meant.</p>
<p>Keep this in mind each time you allocate some memory on the heap.</p>
<h2 id="when-is-the-stack-or-the-heap-used">When is the stack or the heap used?</h2>
<p>System programming languages like C or Rust, tend to offer the programmer fine grained control over where data is stored and when it is cleared. Managed languages like Javascript or C# can tend to be somewhat less deterministic. While they do occasionally offer the ability to be explicit, these are often just suggestions to the compiler, which they may choose to ignore.</p>
<p>Managed languages like Javascript tend to store much more in the heap, as they like to be less strict about the lifetimes of your data. So instead of potentially freeing the data when your function ends, a garbage collector will instead come along later and free it in its own time.</p>
<h2 id="the-takeaway">The takeaway</h2>
<p>So a quick summary of what we&rsquo;ve covered so far.</p>
<ul>
<li>Both the stack and the heap live in RAM (usually)</li>
<li>Differ in how they are managed</li>
<li>Differ in what they are used for</li>
<li>Differ in their performance profile</li>
<li>Stack are managed for you</li>
<li>You (or the GC) are responsible for releasing heap allocations</li>
</ul>
<p>This has obviously been a greatly simplified explanation. The important point to convey here is that the heap is what <em>you</em> as a programmer need to be concerned with, or more accurately the garbage collector does.</p>
<h2 id="what-does-a-garbage-collector-do">What does a garbage collector do?</h2>
<p>Just a warning. I am going to refer to the garbage collector as the conglomeration of systems which are responsible for managing the heap on your behalf. Technically the GC is only really interested in cleaning up your mess, but it is easier to just use it as a catchall for the rest of the systems involved here too.</p>
<p>So the garbage collect/memory management systems tend to do the following:</p>
<ul>
<li>Allocates and manages the heap for you</li>
<li>Reference tracking</li>
<li>Identifies garbage</li>
<li>Reclaims garbage</li>
</ul>
<p>The garbage collector, or heap management systems are responsible for acquiring memory from the OS, tracking its use, and then freeing it up again when you are done using it.</p>
<h2 id="downsides-of-a-garbage-collector">Downsides of a garbage collector</h2>
<p>While the garbage collector does afford you some freedoms, as with all things, it comes with some costs.</p>
<p>They are highly complex systems which run alongside your application, constantly monitoring when and where memory is accessed, looking for opportunities to reclaim any chunks that are no longer in use, and to deal with any issues that arise from its general operation.</p>
<p>The &ldquo;mark-and-sweep&rdquo; technique is one of the more common methods employed by garbage collectors. As the name suggests, it consists of two phases: marking and sweeping. During the marking phase the GC identifies and marks all active references to memory throughout your program, starting from the root stack and global variables. During the sweep phase the GC will scan the heap, freeing any unmarked (unreachable) chunks. This process may require pausing your program entirely, which can result in a negative impact on both the user experience and the performance of your program. This is of particular concern in real-time applications such as video games.</p>
<p>Garbage collectors are also prone to memory fragmentation. This can occur when you request a new block of memory, but the existing available chunks aren&rsquo;t large enough. In this situation this free block will be ignored and instead you will be allocated an entirely new block elsewhere in RAM, potentially leaving this free block unallocated.</p>
<p>It is important to note that even though this block of memory is no longer being used, it might still be owned by the GC, thereby making it unavailable for use by other programs on your system. If enough fragmentation occurs, you can eventually arrive at a situation where the entire system is starved for memory.</p>
<p>GCs employ a number of techniques to address these fragmentation issues, one of which is compaction. This is where the GC will identify small gaps between allocations and rearrange memory to consolidate them, reducing the fragmentation. However, this can be a computationally expensive operation, and therefore potentially problematic in an environment where performance matters.</p>
<h2 id="lets-take-a-look-at-some-rust">Let&rsquo;s take a look at some Rust</h2>
<p>So keeping that all in mind, let&rsquo;s take a look at some Rust.</p>
<p>But first, some Typescript&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;1&#34;</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">v</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`a=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">a</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> v=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">v</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span></code></pre></div><p>In this extremely simple code snippet we are constructing an array of strings. We then assign the first element in the array to <code>a</code> and then print out some information about our current state.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>a<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> v<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>There should be nothing surprising or unusual in this bit of code, and the output is pretty much as we would expect.</p>
<h2 id="the-same-in-rust">The same in Rust</h2>
<p>This bit of Rust illustrates basically the same bit of logic as the Typescript one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> vec![String::from(<span style="color:#e6db74">&#34;1&#34;</span>)];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> v[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;a={} v={:?}&#34;</span>, a, v);
</span></span></code></pre></div><p>It constructs an array of strings and assigns it to <code>v</code>. It then assigns the first element in the array to <code>a</code>, before finally printing out the result, the same as before.</p>
<p>With one exception. It doesn&rsquo;t compile.</p>
<pre tabindex="0"><code>error[E0507]: cannot move out of index of `Vec&lt;String&gt;`
 --&gt; src/main.rs:3:14
  |
3 |     let a = v[0];
  |              ^^^^ move occurs because value has type
				  `String`, which does not implement
				  the `Copy` trait
  |
help: consider borrowing here
  |
3 |     let a = &amp;v[0];
  |              +

For more information about this error,
try `rustc --explain E0507`.
</code></pre><p>For those of you with some experience in Rust the issue here is obvious, but for those coming from a background in more forgiving languages, this can seem strange.</p>
<p>Put simply, when you assign the first element in the array to <code>a</code>, you are telling the compiler to <em>move</em> that value out of the array, and assign it to <code>a</code> instead. Technically this isn&rsquo;t actually what is happening, and the value still resides in the same location in memory, but as far as the Rust borrow checker is concerned, you have moved that value. So any reference to <code>v</code> is now invalid, since it can no longer guarantee what is in the array that <code>v</code> is assigned to.</p>
<h2 id="aquascope">Aquascope</h2>
<p><img src="/why_i_find_rust_interesting/aquascope.png" alt="Aquascope"></p>
<p>Rust has a few fairly helpful tools in its ecosystem. This is one called <code>aquascope</code>, and it allows you to visualise how your Rust code is being interpreted by the compiler.</p>
<p>At line one we can see that <code>v</code> is a pointer to an address on the heap, and that the first element in the array is <code>1</code>. On line two we can see that <code>v</code> is still pointing to the same location, however, <code>a</code> is now also pointing to the first element of the array. Finally we can see that <code>v</code> is now marked as &ldquo;invalid&rdquo;.</p>
<h2 id="the-fix">The fix</h2>
<p>So how do we make this compile?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> vec![String::from(<span style="color:#e6db74">&#34;1&#34;</span>)];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>v[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;a={} v={:?}&#34;</span>, a, v);
</span></span></code></pre></div><p>We simply need to tell the Rust compiler that we only want to <em>borrow</em> the value.</p>
<p>Without the borrow symbol, we are telling the compiler that we want to move the first element out of the array and assign it to <code>a</code>. But now with the new symbol in place, we are instead asking for permission to use the value for a short period of time, after which we&rsquo;ll return it to its original owner.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>a<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> v<span style="color:#f92672">=[</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>With the fix in place, we now get the expected outcome.</p>
<p>It is important to note that the vector, or list of strings here, is actually allocated on the heap, but Rust is able to tell us at compile time, that we are potentially doing something wrong by pointing at the same block of memory from two separate locations, so it instead interprets it as a move.</p>
<p>What we are doing wrong specifically here is not terribly important, and there is plenty of material around that will give you a good explanation on how the borrow checker works and how to work with it. What is important though to understand that Rust is primarily interested in both who owns data, and how long that data lives for. And unlike a garbage collector, it is able to do this at compile time.</p>
<h2 id="what-about-smart-pointers-in-c">What about smart pointers in C++?</h2>
<p>Can&rsquo;t languages like C++ already track ownership with the use of &ldquo;smart pointers&rdquo;, without using a garbage collector?</p>
<p>Yes they can, but Rust&rsquo;s primary selling point is its combination of ownership tracking, along with a strong static analysis of data lifetimes. That, and C++ also allows you to bypass the &ldquo;smart pointers&rdquo; without invoking the wrath of the compiler. Doing the same in Rust is not quite as easy, and tends to be very visible when you do so.</p>
<h2 id="what-is-a-lifetime">What is a lifetime?</h2>
<p>I mentioned lifetimes as being an important part of what Rust does, but what are lifetimes?</p>
<blockquote>
<p>A lifetime is what Rust uses to express the scope, or period of time, for which a reference to a value remains valid.</p>
</blockquote>
<p>It is this concept that also allows Rust to prevent issues that are fairly common in other systems level languages. Such as use-after-frees, dangling references and data races.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;testing&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Here, <code>a</code> is valid for the duration of the function <code>main</code>, or more accurately, it is alive for only a single line. Where normally we would consider the variable freed at the end of the scope, here Rust knows that <code>a</code> is not being used after the line it is initialised on.</p>
<p>It is also important to note that the <code>String</code> type here is allocated on the heap.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">let</span> a;
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">let</span> value <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;testing&#34;</span>);
</span></span><span style="display:flex;"><span>		a <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>value;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	println!(<span style="color:#e6db74">&#34;{}&#34;</span>, a);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Here is another example.</p>
<p>For those who haven&rsquo;t used slightly stricter languages before, <code>value</code> here ceases to exist once we leave the nested scope, so you would normally expect to see a compiler error if you tried to access it outside of that scope.</p>
<p>We also let the compiler know that we want to use the variable <code>a</code> for the entire scope of <code>main</code>, rather than just inside the nested scope.</p>
<p>In most languages, this would work just fine. The garbage collector would see that we&rsquo;ve made another reference to the string, and it would keep it alive for the remainder of the function.</p>
<p>But Rust will complain.</p>
<pre tabindex="0"><code>error[E0597]: `value` does not live long enough
  --&gt; &lt;source&gt;:37:7
   |
37 |         a = &amp;value;
   |             ^^^^^^ borrowed value does not live long
                        enough
38 |     }
   |     - `value` dropped here while still borrowed
39 |
40 |     println!(&#34;{}&#34;, a);
   |                    - borrow later used here
</code></pre><p>It knows that we are assigning <code>a</code> to the borrowed <code>value</code>, and since <code>value</code> doesn&rsquo;t live beyond the nested scope, when we try use <code>a</code> on the last line, we get a compile time error.</p>
<h2 id="rusts-major-innovation">Rust&rsquo;s major innovation</h2>
<blockquote>
<p>It is a combination of tracking the ownership of data, and how long that data lives &ldquo;<strong><em>at compile time</em></strong>&rdquo;.</p>
</blockquote>
<p>This is Rust&rsquo;s major innovation.</p>
<h2 id="so-what">So what?</h2>
<p>&ldquo;So what?&rdquo; you say.</p>
<p>Being able to do this at compile time means that Rust doesn&rsquo;t need to add any additional CPU instructions to manage this memory. Yet, you as a programmer still have complete control over when and where memory is both allocated and freed.</p>
<p>Historically you needed a garbage collector for this kind of freedom, but as covered earlier in the article, those come with a runtime complexity and performance cost. Rust asks for neither.</p>
<p>It does have a cost though.</p>
<p>It comes in the form of shifting a bit of that complexity back onto the programmer. In most situations the compiler can infer what you need, but in a few it cannot, and when that happens you&rsquo;ll need to step in and help it out by providing extra information, or by altering your code.</p>
<p>It is important to note that this complexity does decrease over time. Eventually you&rsquo;ll get use to its idiosyncrasies and you&rsquo;ll likely be back to being as productive as you were with any other language. With the added benefit of the borrow checker helping you to identify bugs that you might not have otherwise found until runtime, if at all.</p>
<h2 id="do-i-recommend-rust">Do I recommend Rust?</h2>
<p>So that&rsquo;s it. That is mostly what I wanted to cover here, but that leaves one big question.</p>
<p>Would I recommend Rust?</p>
<p>Rust is possibly my most used language on hobby projects, and has been since around 2015 when I first started following its progress. It is one of about three languages I usually pick from when starting a new project. (Rust, C and Zig)</p>
<p>But do I recommend it? I&rsquo;m not completely sure.</p>
<p>Even though Rust does make some amazing guarantees at compile time, there is something about it that always bugs me whenever I use it. I tend to find myself constantly solving &ldquo;Rust&rdquo; problems, rather than my actual problems. Even small distractions of this nature can take you completely out of the flow, even if you know what you&rsquo;re trying to do is technically safe.</p>
<p>This is because what Rust considers safe, does not necessarily encompass all possible safe programs. Instead it can only cover a subset.</p>
<p><img src="/why_i_find_rust_interesting/safe-code.png" alt="Safe code"></p>
<p>For the rest, Rust will need you to alter your solution, or at least annotate it in such a way that it understands what you&rsquo;re trying to do. And it is this extra bit of effort that causes me some frustration.</p>
<p>Having said that though, I do think that Rust will likely play a major role in the commercial landscape in the future. Especially in areas where performance matters. Perhaps eating a lot of the roles that C++, Java or C# would have otherwise been a natural fit for. There are already a number of large companies using it for some of their new projects. &ldquo;Safety&rdquo; is an extremely marketable feature, and often that is enough, even without the performance gains.</p>
<p>However, not everyone needs to constantly write &ldquo;safe&rdquo; software, so on a personal level, I do find the added complexity Rust brings to occasionally spoil the fun. Especially when I&rsquo;m just trying to prototype something.</p>
<p>But does Rust deserve some of your time at least? Absolutely! It is one of the best, if not the best programming languages to come out in the last two decades. If nothing else, it will change the way you program in other languages in the future.</p>
<p>For me that is enough to consider it worth at least a bit of your time.</p>
<hr>
<h2 id="references--links">References &amp; Links</h2>
<ul>
<li><a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=76c50e3f581771d0d14552eb13b3d7bbd7d4b922;hb=HEAD">glibc malloc.c implementation</a></li>
<li><a href="https://rustc-dev-guide.rust-lang.org">Rust Compiler Development Guide</a></li>
<li><a href="https://cognitive-engineering-lab.github.io/aquascope/">Aquascope</a></li>
<li><a href="https://www.youtube.com/watch?v=5C_HPTJg5ek">Fireship&rsquo;s Rust in 100 seconds</a></li>
</ul>

    </div>
    
    <div class="nav-center">
    <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fshiver.github.io%2fpost%2fwhy_i_find_rust_interesting%2f" title="Share on Facebook" target="_blank"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fshiver.github.io%2fpost%2fwhy_i_find_rust_interesting%2f" title="Share on LinkedIn" target="_blank"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://twitter.com/home?status=Why%20I%20find%20Rust%20interesting - https%3a%2f%2fshiver.github.io%2fpost%2fwhy_i_find_rust_interesting%2f" title="Tweet this" target="_blank"><span class="fa fa-twitter fa-2x"></span></a>
    <a class="nav-item" href="http://www.reddit.com/submit?url=https%3a%2f%2fshiver.github.io%2fpost%2fwhy_i_find_rust_interesting%2f&title=Why%20I%20find%20Rust%20interesting" title="Share on Reddit" target="_blank"><span class="fa fa-reddit-alien fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="mailto:?subject=Why%20I%20find%20Rust%20interesting&body=%3cp%3eInitially%2c%20I%20planned%20for%20this%20to%20be%20an%20introduction%20to%20the%20Rust%20programming%20language%20for%20colleagues%20at%20work.%20However%2c%20when%20looking%20around%20online%20for%20inspiration%2c%20I%20noticed%20that%20one%20thing%20there%20was%20no%20shortage%20of%2c%20were%20Rust%20introductions.%20So%20with%20that%20in%20mind%2c%20I%20thought%20I%20would%20instead%20focus%20why%20I%20personally%20find%20the%20language%20interesting.%3c%2fp%3e%0a%3cp%3eSo%20I%20won%26rsquo%3bt%20be%20teaching%20you%20how%20to%20write%20Rust.%20I%20won%26rsquo%3bt%20be%20giving%20an%20overview%20of%20the%20language%20syntax%2c%20or%20its%20type%20system.%20I%20won%26rsquo%3bt%20be%20showing%20you%20its%20tooling%2c%20or%20some%20interesting%20projects%20that%20have%20been%20created%20using%20the%20language.%20And%20I%20definitely%20won%26rsquo%3bt%20be%20trying%20to%20convince%20you%20to%20rewrite%20everything%20in%20Rust.%3c%2fp%3e%0a%3cp%3eThere%20are%20already%20countless%20videos%20and%20articles%20online%20which%20cover%20these%20topics%2c%20most%20of%20which%20likely%20do%20at%20least%20a%20semi-decent%20job%20of%20the%20task.%20So%20if%20you%20find%20your%20interest%20piqued%20at%20all%20throughout%20the%20duration%20of%20this%20article%2c%20then%20I%20would%20encourage%20you%20to%20seek%20them%20out%2c%20once%20you%26rsquo%3bre%20done%20reading%20this%20one%20of%20course%21%3c%2fp%3e%0a%3cp%3eInstead%2c%20my%20goal%20today%20is%20to%20try%20and%20explain%20why%20Rust%20is%20both%20unique%20and%20interesting%2c%20and%20why%20I%20think%20you%20should%20at%20least%20give%20it%20a%20try.%3c%2fp%3e%0a%3cp%3eEven%20if%20you%20don%26rsquo%3bt%20end%20up%20using%20the%20language%20long%20term%2c%20much%20like%20learning%20Haskell%20or%20C%2c%20you%26rsquo%3bll%20potentially%20take%20at%20least%20some%20learnings%20from%20it%2c%20which%20can%20then%20applied%20to%20projects%20you%20tackle%20in%20the%20future.%3c%2fp%3e%0a%3ch2%20id%3d%22there-will-be-lies--assembly%22%3eThere%20will%20be%20lies%20%26amp%3b%20assembly%3c%2fh2%3e%0a%3cp%3eI%20will%20be%20glossing%20over%20quite%20a%20bit%20of%20detail%20throughout%20this%20article.%20There%20are%20exceptions%20to%20every%20rule%20and%20given%20the%20scope%20of%20the%20concepts%20I%20will%20be%20trying%20to%20cover%2c%20I%20won%26rsquo%3bt%20be%20able%20to%20describe%20everything%20in%20extreme%20detail.%20Hopefully%20I%20will%20still%20be%20able%20to%20at%20least%20get%20the%20important%20points%20across%20though.%3c%2fp%3e%0a%3cp%3eThere%20will%20also%20be%20a%20bit%20of%20assembly.%20Only%20a%20small%20amount%20though.%20Just%20enough%20to%20show%20you%20how%20something%20%3cem%3eactually%3c%2fem%3e%20works.%3c%2fp%3e%0a%3cp%3eI%20will%20do%20my%20best%20to%20try%20and%20simplify%20it%2c%20but%20as%20long%20as%20you%20have%20a%20grasp%20of%20some%20general%20programming%20concepts%2c%20you%20should%20be%20fine.%20Assembly%20is%20actually%20a%20fairly%20simple%20language%2c%20and%20it%20is%20mostly%20the%20things%20not%20expressed%20in%20the%20language%20itself%20that%20can%20make%20reading%20it%20a%20bit%20confusing%20at%20times.%3c%2fp%3e%0a%3ch2%20id%3d%22first-a-bit-of-background%22%3eFirst%20a%20bit%20of%20background%26hellip%3b%3c%2fh2%3e%0a%3cp%3eTo%20appreciate%20what%20makes%20Rust%20interesting%2c%20you%26rsquo%3bll%20first%20need%20to%20have%20at%20least%20a%20rough%20understanding%20of%20a%20few%20concepts%20you%20have%20most%20likely%20come%20across%20before.%20However%2c%20since%20I%20am%20not%20sure%20just%20%3cem%3ehow%20much%3c%2fem%3e%20you%20know%2c%20you%26rsquo%3bll%20have%20to%20excuse%20me%20while%20I%20tread%20over%20old%20ground.%3c%2fp%3e%0a%3cp%3eAlso%2c%20if%20your%20background%20is%20mostly%20in%20managed%20languages%20like%20Typescript%2c%20Python%20or%20C%23%2c%20then%20it%20could%20be%20difficult%20to%20see%20what%20makes%20Rust%20different%20besides%20some%20extra%20warnings%20given%20to%20you%20by%20the%20compiler%2c%20especially%20given%20that%20the%20syntax%20of%20the%20language%20will%20tend%20to%20look%20pretty%20familiar%20for%20the%20most%20part.%3c%2fp%3e%0a%3cp%3eSo%20to%20be%20sure%20that%20we%20all%20start%20off%20on%20roughly%20the%20same%20page%2c%20I%26rsquo%3bll%20briefly%20go%20over%20how%20programs%20work%20in%20regards%20to%20memory.%20Discussing%20the%20stack%2c%20the%20heap%20and%20garbage%20collectors.%20And%20most%20importantly%2c%20how%20Rust%20manages%20to%20get%20by%20without%20one%2c%20while%20still%20allowing%20you%20to%20work%20in%20much%20the%20same%20manner.%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22%2fwhy_i_find_rust_interesting%2fprogram-memory-layout.png%22%20alt%3d%22Program%20memory%20layout%22%3e%3c%2fp%3e%0a%3cp%3eTo%20start%2c%20this%20is%20a%20fairly%20common%20diagram%20you%26rsquo%3bll%20see%20floating%20around%20the%20internet%20which%20just%20illustrates%20the%20layout%20of%20your%20program%20once%20it%20is%20loaded%20into%20memory.%3c%2fp%3e%0a%3cp%3eYou%20can%20see%20at%20the%20bottom%20we%20have%20the%20%3ccode%3etext%3c%2fcode%3e%20section%2c%20which%20holds%20the%20machine%20code%20instructions%20the%20CPU%20will%20be%20running.%20This%20is%20the%20code%20you%26rsquo%3bve%20written%2c%20after%20being%20converted%20into%20something%20the%20CPU%20can%20understand.%3c%2fp%3e%0a%3cp%3eBut%20what%20we%26rsquo%3bre%20interested%20in%20for%20now%20though%20are%20the%20stack%20and%20the%20heap.%3c%2fp%3e%0a%3ch2%20id%3d%22what-is-the-stack%22%3eWhat%20is%20the%20stack%3f%3c%2fh2%3e%0a%3cul%3e%0a%3cli%3eAllocated%20from%20RAM%20%28typically%20~1MB%20-%208MB%29%3c%2fli%3e%0a%3cli%3eRequested%20by%20and%20assigned%20to%20each%20thread%3c%2fli%3e%0a%3cli%3eMinimal%20management%20overhead%20%28LIFO%29%3c%2fli%3e%0a%3cli%3eAllocated%20in%20one%20contiguous%20block%20%28usually%29%3c%2fli%3e%0a%3cli%3eManaged%20for%20you%20by%20your%20compiler%3c%2fli%3e%0a%3cli%3eData%20on%20the%20stack%20is%20more%20likely%20to%20be%20in%20the%20cache%2a%3c%2fli%3e%0a%3c%2ful%3e%0a%3cp%3eAs%20we%20saw%20in%20the%20previous%20image%2c%20the%20stack%20is%20stored%20in%20RAM.%3c%2fp%3e%0a%3cp%3eIt%20is%20a%20common%20misconception%20that%20the%20stack%20is%20actually%20stored%20somewhere%20else%2c%20perhaps%20even%20on%20the%20CPU%2c%20however%20this%20is%20not%20the%20case.%20Like%20most%20things%2c%20it%20is%20also%20allocated%20from%20RAM.%3c%2fp%3e%0a%3cp%3eEach%20stack%20instance%20is%20typically%20allocated%20in%20one%20contiguous%20block.%20Each%20block%20is%20then%20assigned%20to%20a%20thread.%20So%20if%20you%20have%20an%20application%20which%20is%20using%20four%20threads%2c%20you%26rsquo%3bll%20have%20four%20separate%20stacks.%20Obviously%20if%20you%20don%26rsquo%3bt%20have%20multiple%20threads%2c%20you%26rsquo%3bll%20just%20get%20the%20one.%3c%2fp%3e%0a%3cp%3eThe%20stack%20is%20typically%20allocated%20just%20the%20once%20at%20the%20start%20of%20each%20new%20thread.%20This%20memory%20is%20only%20handed%20back%20to%20the%20OS%20at%20the%20end%20of%20the%20thread%26rsquo%3bs%20lifetime%2c%20or%20when%20your%20program%20exits.%20The%20advantage%20here%20being%20that%20it%20won%26rsquo%3bt%20need%20to%20make%20any%20additional%20calls%20to%20the%20OS%20to%20request%20more%20space.%20Just%20the%20one%20allocation%20for%20the%20lifetime%20the%20thread.%3c%2fp%3e%0a%3cp%3eManagement%20of%20the%20stack%20is%20done%20using%20an%20extremely%20simple%20last-in%2c%20first-out%20data%20structure.%20This%20means%20that%20the%20last%20thing%20you%20push%20onto%20the%20stack%20is%20the%20first%20thing%20that%20will%20be%20removed.%20We%26rsquo%3bll%20see%20an%20example%20of%20this%20shortly%20which%20will%20hopefully%20explain%20things%20a%20bit%20better.%3c%2fp%3e%0a%3cp%3eThe%20size%20of%20the%20stack%20is%20greatly%20dependent%20on%20your%20OS%2c%20hardware%20and%20programming%20language.%20And%20while%20some%20languages%20or%20operating%20systems%20do%20provide%20mechanisms%20to%20expand%20the%20size%20of%20the%20stack%20at%20runtime%2c%20there%20are%20limits%2c%20and%20this%20is%20usually%20not%20a%20done%20thing.%20So%20under%20almost%20all%20circumstances%20you%20should%20expect%20this%20to%20remain%20at%20a%20fixed%20size%20for%20the%20duration%20of%20your%20program.%3c%2fp%3e%0a%3cp%3eOne%20important%20aspect%20of%20the%20stack%20is%20that%20the%20CPU%20has%20more%20than%20likely%20recently%20accessed%20your%20data%20in%20order%20to%20place%20it%20on%20the%20stack%2c%20so%20it%20is%20also%20just%20as%20likely%20that%20the%20data%20will%20be%20in%20the%20CPU%20cache.%20Having%20your%20data%20in%20the%20cache%20will%20usually%20result%20in%20significant%20performance%20improvements.%20Depending%20on%20what%20you%26rsquo%3bre%20doing%20with%20that%20data%20of%20course.%20Mostly%20importantly%20the%20cache%20is%20significantly%20faster%20than%20normal%20memory%2c%20as%20it%20is%20situated%20on%20the%20CPU%20itself.%20So%20it%20doesn%26rsquo%3bt%20operate%20under%20the%20same%20latencies%20that%20normal%20RAM%20does.%3c%2fp%3e%0a%3ch2%20id%3d%22what-is-the-stack-used-for%22%3eWhat%20is%20the%20stack%20used%20for%3c%2fh2%3e%0a%3cp%3eOne%20of%20the%20primary%20purposes%20of%20the%20stack%20is%20to%20facilitate%20function%20calls.%3c%2fp%3e%0a%3cp%3eMore%20specifically%2c%20this%20is%20where%20function%20parameters%20are%20prepared%20before%20calling%20the%20function%20itself.%20It%20is%20also%20responsible%20for%20holding%20the%20function%20return%20address%2c%20which%20is%20the%20location%20where%20the%20program%20will%20jump%20to%20once%20the%20function%20ends.%20The%20stack%20is%20also%20responsible%20for%20holding%20onto%20temporary%20values%20that%20only%20live%20for%20the%20duration%20of%20the%20function.%3c%2fp%3e%0a%3cp%3eThat%20was%20a%20lot%20of%20information%20to%20parse%2c%20so%20it%20might%20help%20to%20see%20what%20this%20looks%20like%20in%20practice.%3c%2fp%3e%0a%3ch2%20id%3d%22how-the-stack-works%22%3eHow%20the%20stack%20works%3c%2fh2%3e%0a%3cp%3e%3cimg%20src%3d%22%2fwhy_i_find_rust_interesting%2fhow-the-stack-works.png%22%20alt%3d%22How%20the%20stack%20works%22%3e%3c%2fp%3e%0a%3cp%3eWhat%20you%20see%20here%20is%20just%20a%20quick%20illustration%20of%20what%20the%20stack%20might%20look%20like%20for%20a%20simple%20function%20%3ccode%3emain%3c%2fcode%3e%20that%20calls%20another%20function%20and%20then%20exits.%3c%2fp%3e%0a%3cp%3eWe%20start%20off%20entering%20the%20main%20function%20where%20the%20stack%20is%20empty.%20We%20then%20allocate%20a%20small%20amount%20of%20space%20for%20a%20local%20variable.%20For%20example%2c%20assigning%20the%20integer%20value%20%3ccode%3e1%3c%2fcode%3e%20to%20a%20variable%20called%20%3ccode%3ea%3c%2fcode%3e.%3c%2fp%3e%0a%3cp%3eAfter%20that%20you%20can%20see%20we%20are%20allocating%20more%20space%20to%20prepare%20to%20make%20a%20call%20to%20a%20function%2c%20allocating%20space%20for%20two%20function%20parameters.%3c%2fp%3e%0a%3cp%3eOnce%20inside%20the%20function%2c%20we%20allocate%20a%20further%20chunk%20to%20hold%20a%20variable%20local%20to%20the%20nested%20function.%20When%20the%20function%20is%20done%2c%20just%20before%20returning%2c%20we%20free%20our%20stack%20space.%20So%20when%20we%20return%20to%20the%20previous%20function%2c%20things%20are%20as%20we%20left%20it.%3c%2fp%3e%0a%3cp%3eFinally%2c%20we%20leave%20the%20main%20function%20and%20the%20remaining%20memory%20is%20%26ldquo%3bfreed%26rdquo%3b.%3c%2fp%3e%0a%3cp%3e%3cem%3eNote%3a%20This%20section%20has%20some%20of%20those%20%3cstrong%3elies%3c%2fstrong%3e%20I%20was%20talking%20about%20earlier.%20There%20are%20registers%20involved%20in%20this%20process%20too%2c%20and%20quite%20often%20it%20won%26rsquo%3bt%20work%20in%20exactly%20this%20manner%2c%20but%20it%20illustrates%20the%20point%20so%20we%26rsquo%3bll%20just%20leave%20it%20at%20that%20and%20move%20on%21%3c%2fem%3e%3c%2fp%3e%0a%3ch2%20id%3d%22what-it-_actually_-looks-like%22%3eWhat%20it%20%3cem%3eactually%3c%2fem%3e%20looks%20like%3c%2fh2%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-c%22%20data-lang%3d%22c%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3evoid%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3emain%3c%2fspan%3e%28%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%20numbers%5b%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%7b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e2%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e3%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e4%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e5%3c%2fspan%3e%7d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eThis%20is%20a%20C%20program%20that%20assigns%20an%20array%20of%20five%20integers%20to%20the%20variable%20%3ccode%3enumbers%3c%2fcode%3e.%20Lets%20take%20a%20look%20at%20a%20bit%20of%20assembly%20to%20see%20how%20this%20is%20represented.%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-asm%22%20data-lang%3d%22asm%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%2f%2f%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eAllocating%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3espace%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efor%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e5%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ex%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e32%3c%2fspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3ebit%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evalues%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e20%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ebytes%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3esub%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e20%3c%2fspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%26lt%3b%3c%2fspan%3e---%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eAllocation%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3e...%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eDWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%5d%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%26lt%3b%3c%2fspan%3e---%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eAssignment%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eincreasing%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eby%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e4%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ebytes%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efor%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eeach%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evalue%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eDWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%2b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e4%3c%2fspan%3e%5d%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e2%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eDWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%2b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e8%3c%2fspan%3e%5d%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e3%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eDWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%2b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e12%3c%2fspan%3e%5d%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e4%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eDWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%2b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e16%3c%2fspan%3e%5d%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e5%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3e...%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3eadd%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e20%3c%2fspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%23960050%3bbackground-color%3a%231e0010%22%3e%26lt%3b%3c%2fspan%3e---%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eRelease%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3ePotentially%20a%20bit%20mystifying%20looking%20if%20you%26rsquo%3bve%20never%20looked%20at%20assembly%20before%2c%20but%20it%20is%20really%20quite%20simple.%3c%2fp%3e%0a%3cp%3e%3ccode%3esub%3c%2fcode%3e%20is%20the%20instruction%20to%20%26ldquo%3bsubtract%26rdquo%3b%20and%20%3ccode%3ersp%3c%2fcode%3e%20refers%20to%20the%20%26ldquo%3bstack%20pointer%26rdquo%3b.%20So%20we%20have%20an%20instruction%20that%20is%20subtracting%20%3ccode%3e20%20bytes%3c%2fcode%3e%20from%20the%20available%20stack%20space.%20This%20is%20all%20we%20need%20to%20do%20to%20allocate%20the%20space%20to%20hold%20our%20array%20of%20five%2032bit%20integers.%3c%2fp%3e%0a%3cp%3eThe%20next%20five%20lines%20copy%20the%20values%20into%20their%20respective%20locations%20on%20the%20stack.%20You%20can%20see%20we%20are%20adding%20four%20to%20the%20stack%20pointer%20each%20time.%204%20bytes%20for%20every%2032bit%20integer.%3c%2fp%3e%0a%3cp%3eThe%20only%20real%20important%20thing%20to%20note%20here%20is%20that%20both%20the%20allocation%20and%20the%20release%20of%20the%20space%20are%20achieved%20in%20single%20CPU%20instructions.%3c%2fp%3e%0a%3cp%3eThis%20is%20why%20the%20stack%20is%20fast%2c%20and%20this%20is%20why%20it%20usually%20a%20place%20you%20want%20to%20have%20your%20data%20when%20the%20CPU%20is%20doing%20work.%3c%2fp%3e%0a%3cp%3eIt%20is%20worth%20stressing%20that%20we%20are%20not%20technically%20allocating%2c%20or%20freeing%20new%20chunks%20of%20memory%20here.%20Instead%20we%20are%20simply%20changing%20the%20spot%20we%26rsquo%3bre%20pointing%20to%20in%20a%20large%20chunk%20of%20memory%20that%20has%20already%20been%20allocated.%3c%2fp%3e%0a%3ch2%20id%3d%22what-is-the-heap%22%3eWhat%20is%20the%20heap%3c%2fh2%3e%0a%3cp%3eNow%20let%26rsquo%3bs%20take%20a%20look%20at%20the%20heap.%3c%2fp%3e%0a%3cp%3eUnlike%20the%20stack%2c%20the%20heap%20is%20allocated%20dynamically%20at%20runtime.%20However%2c%20much%20like%20the%20stack%2c%20it%20is%20also%20stored%20in%20RAM.%20The%20main%20benefit%20of%20the%20heap%20though%20is%20its%20ability%20to%20grow%20to%20fit%20whatever%20you%20need%20as%20long%20as%20you%20have%20enough%20physical%20RAM%20to%20support%20it.%3c%2fp%3e%0a%3cp%3eMore%20importantly%20the%20heap%20is%20made%20up%20of%20a%20number%20of%20randomly%20sized%20small%20chunks%20of%20memory.%20It%20is%20this%20trait%20that%20sets%20it%20apart%20the%20most%20from%20the%20stack%20with%20its%20single%20contiguous%20block.%20Having%20its%20allocations%20spread%20around%20requires%20a%20lot%20of%20bookkeeping.%20It%20needs%20to%20keep%20track%20of%20which%20blocks%20are%20used%2c%20which%20have%20been%20freed%20and%20how%20much%20space%20is%20still%20available.%20It%20is%20this%20management%20overhead%20that%20causes%20the%20heap%20to%20often%20be%20quite%20a%20bit%20slower%20than%20the%20stack%2c%20especially%20for%20applications%20which%20make%20a%20large%20number%20of%20allocations%20at%20runtime.%3c%2fp%3e%0a%3cp%3eAlso%2c%20the%20heap%20can%20become%20fragmented%20over%20time.%20As%20each%20chunk%20is%20freed%2c%20it%20potentially%20leaves%20a%20small%20gap%20that%20may%20be%20too%20small%20to%20fit%20another%20allocation%2c%20effectively%20rendering%20the%20block%20unusable%20and%20akin%20to%20a%20memory%20leak.%3c%2fp%3e%0a%3cp%3eYour%20OS%20will%20employ%20some%20techniques%20that%20will%20attempt%20to%20deal%20with%20these%20sorts%20of%20issues%2c%20but%20this%20means%20that%20each%20time%20you%20request%20or%20free%20a%20block%20of%20memory%20on%20the%20heap%2c%20you%26rsquo%3bre%20potentially%20incurring%20some%20management%20overhead%2c%20and%20wasting%20CPU%20cycles%20doing%20administrative%20work%20instead%20of%20the%20work%20you%20actually%20want%20it%20to%20do.%3c%2fp%3e%0a%3cp%3eIt%20is%20important%20to%20note%20that%20unlike%20the%20stack%2c%20the%20memory%20you%20request%20from%20the%20heap%20needs%20to%20be%20freed%20by%20you%2c%20the%20programmer.%20Perhaps%20more%20commonly%20these%20days%2c%20the%20garbage%20collector.%3c%2fp%3e%0a%3ch2%20id%3d%22what-is-the-heap-used-for%22%3eWhat%20is%20the%20heap%20used%20for%3c%2fh2%3e%0a%3cp%3eSo%20what%20is%20the%20heap%20used%20for%3f%3c%2fp%3e%0a%3cp%3ePut%20simply%3a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3eData%20that%20either%20needs%20to%20live%20longer%20than%20the%20scope%20of%20a%20function%3c%2fli%3e%0a%3cli%3eWhen%20you%20don%26rsquo%3bt%20know%20how%20much%20space%20you%26rsquo%3bll%20need%20until%20runtime%3c%2fli%3e%0a%3cli%3eData%20that%20exceeds%20the%20size%20limit%20of%20the%20space%20available%20to%20the%20stack%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch2%20id%3d%22how-the-heap-works%22%3eHow%20the%20heap%20works%3c%2fh2%3e%0a%3cp%3e%3cimg%20src%3d%22%2fwhy_i_find_rust_interesting%2fhow-the-heap-works.png%22%20alt%3d%22How%20the%20heap%20works%22%3e%3c%2fp%3e%0a%3cp%3eThis%20is%20an%20overview%20of%20what%20your%20system%20memory%20might%20look%20like%20when%20running%20your%20program.%3c%2fp%3e%0a%3cp%3eYou%26rsquo%3bll%20notice%20the%20single%20large%20block%20holding%20our%20stack.%20Then%20we%20have%20a%20number%20of%20other%20randomly%20sized%20allocations%20littered%20about.%20These%20might%20be%20ours%2c%20but%20they%20could%20also%20be%20from%20another%20program%20entirely.%20Which%20blocks%20you%20get%20is%20completely%20up%20to%20the%20OS.%3c%2fp%3e%0a%3cp%3eIf%20you%20take%20a%20look%20at%20the%20bottom%20left%2c%20you%20can%20see%20some%20data%20being%20copied%20from%20the%20stack%20to%20the%20heap.%20In%20the%20center%20image%20we%26rsquo%3bve%20allocated%20some%20space%20from%20the%20available%20pool%2c%20which%20now%20holds%20our%20data.%3c%2fp%3e%0a%3cp%3eIn%20the%20image%20at%20the%20bottom%20we%20can%20see%20what%20it%20looks%20like%20when%20a%20number%20of%20chunks%20have%20been%20released%20back%20to%20the%20OS%2c%20illustrating%20what%20memory%20fragmentation%20looks%20like.%3c%2fp%3e%0a%3ch2%20id%3d%22what-it-_actually_-looks-like-1%22%3eWhat%20it%20%3cem%3eactually%3c%2fem%3e%20looks%20like%3c%2fh2%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-c%22%20data-lang%3d%22c%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3estatic%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%20values%5b%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%7b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e2%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e3%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e4%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e5%3c%2fspan%3e%7d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3evoid%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eheap%3c%2fspan%3e%28%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%20numbers%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%29malloc%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3esizeof%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%20LEN%28values%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09memcpy%28numbers%2c%20values%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3esizeof%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%20LEN%28values%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eOnce%20again%2c%20this%20is%20a%20little%20bit%20of%20C%20code.%3c%2fp%3e%0a%3cp%3eIt%20is%20not%20important%20for%20you%20to%20be%20able%20to%20read%20it%2c%20you%20only%20need%20to%20understand%20that%20it%20does%20mostly%20what%20we%20did%20in%20the%20previous%20example%20I%20showed%2c%20where%20we%20had%20some%20values%20stored%20on%20the%20stack.%20However%2c%20this%20time%20around%2c%20much%20like%20the%20diagram%20in%20the%20previous%20slide%2c%20we%20are%20taking%20the%20data%20stored%20on%20the%20stack%20and%20copying%20into%20the%20heap.%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-c%22%20data-lang%3d%22c%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3estatic%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%20values%5b%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%7b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e2%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e3%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e4%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e5%3c%2fspan%3e%7d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3evoid%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eheap%3c%2fspan%3e%28%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%20numbers%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%29malloc%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3esizeof%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%20LEN%28values%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09memcpy%28numbers%2c%20values%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3esizeof%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%2366d9ef%22%3eint%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2a%3c%2fspan%3e%20LEN%28values%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-asm%22%20data-lang%3d%22asm%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3erbp%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3esub%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ersp%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e16%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eDWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%20%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3erbp-4%3c%2fspan%3e%5d%2c%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e5%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eeax%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eDWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%20%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3erbp-4%3c%2fspan%3e%5d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3e...%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3erdi%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3erax%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3ecall%3c%2fspan%3e%20%c2%a0%20%c2%a0%3cspan%20style%3d%22color%3a%2366d9ef%22%3emalloc%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eQWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%20%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3erbp-16%3c%2fspan%3e%5d%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3erax%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3e...%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3erax%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eQWORD%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ePTR%3c%2fspan%3e%20%5b%3cspan%20style%3d%22color%3a%2366d9ef%22%3erbp-16%3c%2fspan%3e%5d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eesi%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eOFFSET%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eFLAT%3c%2fspan%3e%3a%3cspan%20style%3d%22color%3a%2366d9ef%22%3evalues%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3emov%3c%2fspan%3e%20%c2%a0%20%c2%a0%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3erdi%3c%2fspan%3e%2c%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3erax%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3ecall%3c%2fspan%3e%20%c2%a0%20%c2%a0%3cspan%20style%3d%22color%3a%2366d9ef%22%3ememcpy%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eAnd%20here%20is%20the%20assembly%20for%20that.%3c%2fp%3e%0a%3cp%3eFirstly%2c%20we%20allocate%20a%20bit%20of%20stack%20space%20for%20the%20operations%20we%26rsquo%3bll%20need%20to%20perform%20in%20this%20function%20totalling%2016%20bytes.%20We%20then%20load%20the%20length%20of%20our%20array%20onto%20the%20stack%20and%20execution%20a%20few%20more%20instructions%20to%20setup%20the%20data%20required%20before%20we%20make%20our%20call%20to%20%3ccode%3emalloc%3c%2fcode%3e.%3c%2fp%3e%0a%3cp%3eOut%20of%20that%20comes%20our%20address%20to%20the%20block%20of%20memory%20we%26rsquo%3bve%20been%20given%2c%20stored%20in%20the%20%3ccode%3erax%3c%2fcode%3e%20register.%20We%20then%20use%20that%20bit%20of%20information%20to%20copy%20our%20values%20onto%20the%20heap%20by%20calling%20%3ccode%3ememcpy%3c%2fcode%3e.%20If%20you%26rsquo%3bve%20used%20C%20at%20all%2c%20you%20should%20definitely%20be%20familiar%20with%20these%20two%20functions.%3c%2fp%3e%0a%3cp%3eImportantly%20you%20won%26rsquo%3bt%20see%20any%20reference%20to%20the%20heap%20memory%20being%20deallocated%20here.%20This%20is%20something%20we%26rsquo%3bll%20need%20to%20call%20manually%20at%20some%20point%20in%20our%20program.%20At%20the%20moment%20we%20have%20a%20memory%20leak.%3c%2fp%3e%0a%3cp%3eI%20would%20like%20you%20to%20note%20the%20call%20to%20%3ccode%3emalloc%3c%2fcode%3e%20here%20though%2c%20and%20urge%20you%20to%20take%20a%20look%20at%20its%20%3ca%20href%3d%22https%3a%2f%2fsourceware.org%2fgit%2f%3fp%3dglibc.git%3ba%3dblob%3bf%3dmalloc%2fmalloc.c%3bh%3d76c50e3f581771d0d14552eb13b3d7bbd7d4b922%3bhb%3dHEAD%22%3eglibc%3c%2fa%3e%20implementation%20in%20your%20own%20time.%20This%20is%20likely%20what%20your%20program%20will%20use%20when%20requesting%20memory%20from%20the%20OS%20on%20Linux%20based%20machines.%3c%2fp%3e%0a%3cp%3eA%20quick%20summary%20though%3a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3e40%20functions%3c%2fli%3e%0a%3cli%3e20%20data%20structures%3c%2fli%3e%0a%3cli%3emultiple%20source%20files%3c%2fli%3e%0a%3cli%3eapproximately%2020%2c000%20lines%20of%20C%20code%3c%2fli%3e%0a%3c%2ful%3e%0a%3cp%3eWhen%20I%20mentioned%20that%20allocating%20memory%20on%20the%20heap%20was%20complicated%20and%20had%20a%20fair%20amount%20of%20administrative%20overhead.%20This%20is%20what%20I%20meant.%3c%2fp%3e%0a%3cp%3eKeep%20this%20in%20mind%20each%20time%20you%20allocate%20some%20memory%20on%20the%20heap.%3c%2fp%3e%0a%3ch2%20id%3d%22when-is-the-stack-or-the-heap-used%22%3eWhen%20is%20the%20stack%20or%20the%20heap%20used%3f%3c%2fh2%3e%0a%3cp%3eSystem%20programming%20languages%20like%20C%20or%20Rust%2c%20tend%20to%20offer%20the%20programmer%20fine%20grained%20control%20over%20where%20data%20is%20stored%20and%20when%20it%20is%20cleared.%20Managed%20languages%20like%20Javascript%20or%20C%23%20can%20tend%20to%20be%20somewhat%20less%20deterministic.%20While%20they%20do%20occasionally%20offer%20the%20ability%20to%20be%20explicit%2c%20these%20are%20often%20just%20suggestions%20to%20the%20compiler%2c%20which%20they%20may%20choose%20to%20ignore.%3c%2fp%3e%0a%3cp%3eManaged%20languages%20like%20Javascript%20tend%20to%20store%20much%20more%20in%20the%20heap%2c%20as%20they%20like%20to%20be%20less%20strict%20about%20the%20lifetimes%20of%20your%20data.%20So%20instead%20of%20potentially%20freeing%20the%20data%20when%20your%20function%20ends%2c%20a%20garbage%20collector%20will%20instead%20come%20along%20later%20and%20free%20it%20in%20its%20own%20time.%3c%2fp%3e%0a%3ch2%20id%3d%22the-takeaway%22%3eThe%20takeaway%3c%2fh2%3e%0a%3cp%3eSo%20a%20quick%20summary%20of%20what%20we%26rsquo%3bve%20covered%20so%20far.%3c%2fp%3e%0a%3cul%3e%0a%3cli%3eBoth%20the%20stack%20and%20the%20heap%20live%20in%20RAM%20%28usually%29%3c%2fli%3e%0a%3cli%3eDiffer%20in%20how%20they%20are%20managed%3c%2fli%3e%0a%3cli%3eDiffer%20in%20what%20they%20are%20used%20for%3c%2fli%3e%0a%3cli%3eDiffer%20in%20their%20performance%20profile%3c%2fli%3e%0a%3cli%3eStack%20are%20managed%20for%20you%3c%2fli%3e%0a%3cli%3eYou%20%28or%20the%20GC%29%20are%20responsible%20for%20releasing%20heap%20allocations%3c%2fli%3e%0a%3c%2ful%3e%0a%3cp%3eThis%20has%20obviously%20been%20a%20greatly%20simplified%20explanation.%20The%20important%20point%20to%20convey%20here%20is%20that%20the%20heap%20is%20what%20%3cem%3eyou%3c%2fem%3e%20as%20a%20programmer%20need%20to%20be%20concerned%20with%2c%20or%20more%20accurately%20the%20garbage%20collector%20does.%3c%2fp%3e%0a%3ch2%20id%3d%22what-does-a-garbage-collector-do%22%3eWhat%20does%20a%20garbage%20collector%20do%3f%3c%2fh2%3e%0a%3cp%3eJust%20a%20warning.%20I%20am%20going%20to%20refer%20to%20the%20garbage%20collector%20as%20the%20conglomeration%20of%20systems%20which%20are%20responsible%20for%20managing%20the%20heap%20on%20your%20behalf.%20Technically%20the%20GC%20is%20only%20really%20interested%20in%20cleaning%20up%20your%20mess%2c%20but%20it%20is%20easier%20to%20just%20use%20it%20as%20a%20catchall%20for%20the%20rest%20of%20the%20systems%20involved%20here%20too.%3c%2fp%3e%0a%3cp%3eSo%20the%20garbage%20collect%2fmemory%20management%20systems%20tend%20to%20do%20the%20following%3a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3eAllocates%20and%20manages%20the%20heap%20for%20you%3c%2fli%3e%0a%3cli%3eReference%20tracking%3c%2fli%3e%0a%3cli%3eIdentifies%20garbage%3c%2fli%3e%0a%3cli%3eReclaims%20garbage%3c%2fli%3e%0a%3c%2ful%3e%0a%3cp%3eThe%20garbage%20collector%2c%20or%20heap%20management%20systems%20are%20responsible%20for%20acquiring%20memory%20from%20the%20OS%2c%20tracking%20its%20use%2c%20and%20then%20freeing%20it%20up%20again%20when%20you%20are%20done%20using%20it.%3c%2fp%3e%0a%3ch2%20id%3d%22downsides-of-a-garbage-collector%22%3eDownsides%20of%20a%20garbage%20collector%3c%2fh2%3e%0a%3cp%3eWhile%20the%20garbage%20collector%20does%20afford%20you%20some%20freedoms%2c%20as%20with%20all%20things%2c%20it%20comes%20with%20some%20costs.%3c%2fp%3e%0a%3cp%3eThey%20are%20highly%20complex%20systems%20which%20run%20alongside%20your%20application%2c%20constantly%20monitoring%20when%20and%20where%20memory%20is%20accessed%2c%20looking%20for%20opportunities%20to%20reclaim%20any%20chunks%20that%20are%20no%20longer%20in%20use%2c%20and%20to%20deal%20with%20any%20issues%20that%20arise%20from%20its%20general%20operation.%3c%2fp%3e%0a%3cp%3eThe%20%26ldquo%3bmark-and-sweep%26rdquo%3b%20technique%20is%20one%20of%20the%20more%20common%20methods%20employed%20by%20garbage%20collectors.%20As%20the%20name%20suggests%2c%20it%20consists%20of%20two%20phases%3a%20marking%20and%20sweeping.%20During%20the%20marking%20phase%20the%20GC%20identifies%20and%20marks%20all%20active%20references%20to%20memory%20throughout%20your%20program%2c%20starting%20from%20the%20root%20stack%20and%20global%20variables.%20During%20the%20sweep%20phase%20the%20GC%20will%20scan%20the%20heap%2c%20freeing%20any%20unmarked%20%28unreachable%29%20chunks.%20This%20process%20may%20require%20pausing%20your%20program%20entirely%2c%20which%20can%20result%20in%20a%20negative%20impact%20on%20both%20the%20user%20experience%20and%20the%20performance%20of%20your%20program.%20This%20is%20of%20particular%20concern%20in%20real-time%20applications%20such%20as%20video%20games.%3c%2fp%3e%0a%3cp%3eGarbage%20collectors%20are%20also%20prone%20to%20memory%20fragmentation.%20This%20can%20occur%20when%20you%20request%20a%20new%20block%20of%20memory%2c%20but%20the%20existing%20available%20chunks%20aren%26rsquo%3bt%20large%20enough.%20In%20this%20situation%20this%20free%20block%20will%20be%20ignored%20and%20instead%20you%20will%20be%20allocated%20an%20entirely%20new%20block%20elsewhere%20in%20RAM%2c%20potentially%20leaving%20this%20free%20block%20unallocated.%3c%2fp%3e%0a%3cp%3eIt%20is%20important%20to%20note%20that%20even%20though%20this%20block%20of%20memory%20is%20no%20longer%20being%20used%2c%20it%20might%20still%20be%20owned%20by%20the%20GC%2c%20thereby%20making%20it%20unavailable%20for%20use%20by%20other%20programs%20on%20your%20system.%20If%20enough%20fragmentation%20occurs%2c%20you%20can%20eventually%20arrive%20at%20a%20situation%20where%20the%20entire%20system%20is%20starved%20for%20memory.%3c%2fp%3e%0a%3cp%3eGCs%20employ%20a%20number%20of%20techniques%20to%20address%20these%20fragmentation%20issues%2c%20one%20of%20which%20is%20compaction.%20This%20is%20where%20the%20GC%20will%20identify%20small%20gaps%20between%20allocations%20and%20rearrange%20memory%20to%20consolidate%20them%2c%20reducing%20the%20fragmentation.%20However%2c%20this%20can%20be%20a%20computationally%20expensive%20operation%2c%20and%20therefore%20potentially%20problematic%20in%20an%20environment%20where%20performance%20matters.%3c%2fp%3e%0a%3ch2%20id%3d%22lets-take-a-look-at-some-rust%22%3eLet%26rsquo%3bs%20take%20a%20look%20at%20some%20Rust%3c%2fh2%3e%0a%3cp%3eSo%20keeping%20that%20all%20in%20mind%2c%20let%26rsquo%3bs%20take%20a%20look%20at%20some%20Rust.%3c%2fp%3e%0a%3cp%3eBut%20first%2c%20some%20Typescript%26hellip%3b%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-typescript%22%20data-lang%3d%22typescript%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3ev%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b1%26%2334%3b%3c%2fspan%3e%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3ea%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3ev%3c%2fspan%3e%5b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e0%3c%2fspan%3e%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3econsole%3c%2fspan%3e.%3cspan%20style%3d%22color%3a%23a6e22e%22%3elog%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%60a%3d%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%24%7b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3ea%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%7d%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%20v%3d%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%24%7b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3ev%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%7d%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%60%3c%2fspan%3e%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eIn%20this%20extremely%20simple%20code%20snippet%20we%20are%20constructing%20an%20array%20of%20strings.%20We%20then%20assign%20the%20first%20element%20in%20the%20array%20to%20%3ccode%3ea%3c%2fcode%3e%20and%20then%20print%20out%20some%20information%20about%20our%20current%20state.%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-shell%22%20data-lang%3d%22shell%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3ea%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%20v%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eThere%20should%20be%20nothing%20surprising%20or%20unusual%20in%20this%20bit%20of%20code%2c%20and%20the%20output%20is%20pretty%20much%20as%20we%20would%20expect.%3c%2fp%3e%0a%3ch2%20id%3d%22the-same-in-rust%22%3eThe%20same%20in%20Rust%3c%2fh2%3e%0a%3cp%3eThis%20bit%20of%20Rust%20illustrates%20basically%20the%20same%20bit%20of%20logic%20as%20the%20Typescript%20one.%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-rust%22%20data-lang%3d%22rust%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20v%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20vec%21%5bString%3a%3afrom%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b1%26%2334%3b%3c%2fspan%3e%29%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20a%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20v%5b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e0%3c%2fspan%3e%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3eprintln%21%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3ba%3d%7b%7d%20v%3d%7b%3a%3f%7d%26%2334%3b%3c%2fspan%3e%2c%20a%2c%20v%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eIt%20constructs%20an%20array%20of%20strings%20and%20assigns%20it%20to%20%3ccode%3ev%3c%2fcode%3e.%20It%20then%20assigns%20the%20first%20element%20in%20the%20array%20to%20%3ccode%3ea%3c%2fcode%3e%2c%20before%20finally%20printing%20out%20the%20result%2c%20the%20same%20as%20before.%3c%2fp%3e%0a%3cp%3eWith%20one%20exception.%20It%20doesn%26rsquo%3bt%20compile.%3c%2fp%3e%0a%3cpre%20tabindex%3d%220%22%3e%3ccode%3eerror%5bE0507%5d%3a%20cannot%20move%20out%20of%20index%20of%20%60Vec%26lt%3bString%26gt%3b%60%0a%20--%26gt%3b%20src%2fmain.rs%3a3%3a14%0a%20%20%7c%0a3%20%7c%20%20%20%20%20let%20a%20%3d%20v%5b0%5d%3b%0a%20%20%7c%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5e%5e%5e%5e%20move%20occurs%20because%20value%20has%20type%0a%09%09%09%09%20%20%60String%60%2c%20which%20does%20not%20implement%0a%09%09%09%09%20%20the%20%60Copy%60%20trait%0a%20%20%7c%0ahelp%3a%20consider%20borrowing%20here%0a%20%20%7c%0a3%20%7c%20%20%20%20%20let%20a%20%3d%20%26amp%3bv%5b0%5d%3b%0a%20%20%7c%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2b%0a%0aFor%20more%20information%20about%20this%20error%2c%0atry%20%60rustc%20--explain%20E0507%60.%0a%3c%2fcode%3e%3c%2fpre%3e%3cp%3eFor%20those%20of%20you%20with%20some%20experience%20in%20Rust%20the%20issue%20here%20is%20obvious%2c%20but%20for%20those%20coming%20from%20a%20background%20in%20more%20forgiving%20languages%2c%20this%20can%20seem%20strange.%3c%2fp%3e%0a%3cp%3ePut%20simply%2c%20when%20you%20assign%20the%20first%20element%20in%20the%20array%20to%20%3ccode%3ea%3c%2fcode%3e%2c%20you%20are%20telling%20the%20compiler%20to%20%3cem%3emove%3c%2fem%3e%20that%20value%20out%20of%20the%20array%2c%20and%20assign%20it%20to%20%3ccode%3ea%3c%2fcode%3e%20instead.%20Technically%20this%20isn%26rsquo%3bt%20actually%20what%20is%20happening%2c%20and%20the%20value%20still%20resides%20in%20the%20same%20location%20in%20memory%2c%20but%20as%20far%20as%20the%20Rust%20borrow%20checker%20is%20concerned%2c%20you%20have%20moved%20that%20value.%20So%20any%20reference%20to%20%3ccode%3ev%3c%2fcode%3e%20is%20now%20invalid%2c%20since%20it%20can%20no%20longer%20guarantee%20what%20is%20in%20the%20array%20that%20%3ccode%3ev%3c%2fcode%3e%20is%20assigned%20to.%3c%2fp%3e%0a%3ch2%20id%3d%22aquascope%22%3eAquascope%3c%2fh2%3e%0a%3cp%3e%3cimg%20src%3d%22%2fwhy_i_find_rust_interesting%2faquascope.png%22%20alt%3d%22Aquascope%22%3e%3c%2fp%3e%0a%3cp%3eRust%20has%20a%20few%20fairly%20helpful%20tools%20in%20its%20ecosystem.%20This%20is%20one%20called%20%3ccode%3eaquascope%3c%2fcode%3e%2c%20and%20it%20allows%20you%20to%20visualise%20how%20your%20Rust%20code%20is%20being%20interpreted%20by%20the%20compiler.%3c%2fp%3e%0a%3cp%3eAt%20line%20one%20we%20can%20see%20that%20%3ccode%3ev%3c%2fcode%3e%20is%20a%20pointer%20to%20an%20address%20on%20the%20heap%2c%20and%20that%20the%20first%20element%20in%20the%20array%20is%20%3ccode%3e1%3c%2fcode%3e.%20On%20line%20two%20we%20can%20see%20that%20%3ccode%3ev%3c%2fcode%3e%20is%20still%20pointing%20to%20the%20same%20location%2c%20however%2c%20%3ccode%3ea%3c%2fcode%3e%20is%20now%20also%20pointing%20to%20the%20first%20element%20of%20the%20array.%20Finally%20we%20can%20see%20that%20%3ccode%3ev%3c%2fcode%3e%20is%20now%20marked%20as%20%26ldquo%3binvalid%26rdquo%3b.%3c%2fp%3e%0a%3ch2%20id%3d%22the-fix%22%3eThe%20fix%3c%2fh2%3e%0a%3cp%3eSo%20how%20do%20we%20make%20this%20compile%3f%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-rust%22%20data-lang%3d%22rust%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20v%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20vec%21%5bString%3a%3afrom%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b1%26%2334%3b%3c%2fspan%3e%29%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20a%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%26amp%3b%3c%2fspan%3ev%5b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e0%3c%2fspan%3e%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%5e%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3eprintln%21%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3ba%3d%7b%7d%20v%3d%7b%3a%3f%7d%26%2334%3b%3c%2fspan%3e%2c%20a%2c%20v%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eWe%20simply%20need%20to%20tell%20the%20Rust%20compiler%20that%20we%20only%20want%20to%20%3cem%3eborrow%3c%2fem%3e%20the%20value.%3c%2fp%3e%0a%3cp%3eWithout%20the%20borrow%20symbol%2c%20we%20are%20telling%20the%20compiler%20that%20we%20want%20to%20move%20the%20first%20element%20out%20of%20the%20array%20and%20assign%20it%20to%20%3ccode%3ea%3c%2fcode%3e.%20But%20now%20with%20the%20new%20symbol%20in%20place%2c%20we%20are%20instead%20asking%20for%20permission%20to%20use%20the%20value%20for%20a%20short%20period%20of%20time%2c%20after%20which%20we%26rsquo%3bll%20return%20it%20to%20its%20original%20owner.%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-shell%22%20data-lang%3d%22shell%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3ea%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%20v%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%5b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b1%26%2334%3b%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e%5d%3c%2fspan%3e%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eWith%20the%20fix%20in%20place%2c%20we%20now%20get%20the%20expected%20outcome.%3c%2fp%3e%0a%3cp%3eIt%20is%20important%20to%20note%20that%20the%20vector%2c%20or%20list%20of%20strings%20here%2c%20is%20actually%20allocated%20on%20the%20heap%2c%20but%20Rust%20is%20able%20to%20tell%20us%20at%20compile%20time%2c%20that%20we%20are%20potentially%20doing%20something%20wrong%20by%20pointing%20at%20the%20same%20block%20of%20memory%20from%20two%20separate%20locations%2c%20so%20it%20instead%20interprets%20it%20as%20a%20move.%3c%2fp%3e%0a%3cp%3eWhat%20we%20are%20doing%20wrong%20specifically%20here%20is%20not%20terribly%20important%2c%20and%20there%20is%20plenty%20of%20material%20around%20that%20will%20give%20you%20a%20good%20explanation%20on%20how%20the%20borrow%20checker%20works%20and%20how%20to%20work%20with%20it.%20What%20is%20important%20though%20to%20understand%20that%20Rust%20is%20primarily%20interested%20in%20both%20who%20owns%20data%2c%20and%20how%20long%20that%20data%20lives%20for.%20And%20unlike%20a%20garbage%20collector%2c%20it%20is%20able%20to%20do%20this%20at%20compile%20time.%3c%2fp%3e%0a%3ch2%20id%3d%22what-about-smart-pointers-in-c%22%3eWhat%20about%20smart%20pointers%20in%20C%2b%2b%3f%3c%2fh2%3e%0a%3cp%3eCan%26rsquo%3bt%20languages%20like%20C%2b%2b%20already%20track%20ownership%20with%20the%20use%20of%20%26ldquo%3bsmart%20pointers%26rdquo%3b%2c%20without%20using%20a%20garbage%20collector%3f%3c%2fp%3e%0a%3cp%3eYes%20they%20can%2c%20but%20Rust%26rsquo%3bs%20primary%20selling%20point%20is%20its%20combination%20of%20ownership%20tracking%2c%20along%20with%20a%20strong%20static%20analysis%20of%20data%20lifetimes.%20That%2c%20and%20C%2b%2b%20also%20allows%20you%20to%20bypass%20the%20%26ldquo%3bsmart%20pointers%26rdquo%3b%20without%20invoking%20the%20wrath%20of%20the%20compiler.%20Doing%20the%20same%20in%20Rust%20is%20not%20quite%20as%20easy%2c%20and%20tends%20to%20be%20very%20visible%20when%20you%20do%20so.%3c%2fp%3e%0a%3ch2%20id%3d%22what-is-a-lifetime%22%3eWhat%20is%20a%20lifetime%3f%3c%2fh2%3e%0a%3cp%3eI%20mentioned%20lifetimes%20as%20being%20an%20important%20part%20of%20what%20Rust%20does%2c%20but%20what%20are%20lifetimes%3f%3c%2fp%3e%0a%3cblockquote%3e%0a%3cp%3eA%20lifetime%20is%20what%20Rust%20uses%20to%20express%20the%20scope%2c%20or%20period%20of%20time%2c%20for%20which%20a%20reference%20to%20a%20value%20remains%20valid.%3c%2fp%3e%0a%3c%2fblockquote%3e%0a%3cp%3eIt%20is%20this%20concept%20that%20also%20allows%20Rust%20to%20prevent%20issues%20that%20are%20fairly%20common%20in%20other%20systems%20level%20languages.%20Such%20as%20use-after-frees%2c%20dangling%20references%20and%20data%20races.%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-rust%22%20data-lang%3d%22rust%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3efn%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3emain%3c%2fspan%3e%28%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20a%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20String%3a%3afrom%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3btesting%26%2334%3b%3c%2fspan%3e%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eHere%2c%20%3ccode%3ea%3c%2fcode%3e%20is%20valid%20for%20the%20duration%20of%20the%20function%20%3ccode%3emain%3c%2fcode%3e%2c%20or%20more%20accurately%2c%20it%20is%20alive%20for%20only%20a%20single%20line.%20Where%20normally%20we%20would%20consider%20the%20variable%20freed%20at%20the%20end%20of%20the%20scope%2c%20here%20Rust%20knows%20that%20%3ccode%3ea%3c%2fcode%3e%20is%20not%20being%20used%20after%20the%20line%20it%20is%20initialised%20on.%3c%2fp%3e%0a%3cp%3eIt%20is%20also%20important%20to%20note%20that%20the%20%3ccode%3eString%3c%2fcode%3e%20type%20here%20is%20allocated%20on%20the%20heap.%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-rust%22%20data-lang%3d%22rust%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3efn%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3emain%3c%2fspan%3e%28%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20a%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%09%3cspan%20style%3d%22color%3a%2366d9ef%22%3elet%3c%2fspan%3e%20value%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20String%3a%3afrom%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3btesting%26%2334%3b%3c%2fspan%3e%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%09a%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%26amp%3b%3c%2fspan%3evalue%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09println%21%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%7b%7d%26%2334%3b%3c%2fspan%3e%2c%20a%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3eHere%20is%20another%20example.%3c%2fp%3e%0a%3cp%3eFor%20those%20who%20haven%26rsquo%3bt%20used%20slightly%20stricter%20languages%20before%2c%20%3ccode%3evalue%3c%2fcode%3e%20here%20ceases%20to%20exist%20once%20we%20leave%20the%20nested%20scope%2c%20so%20you%20would%20normally%20expect%20to%20see%20a%20compiler%20error%20if%20you%20tried%20to%20access%20it%20outside%20of%20that%20scope.%3c%2fp%3e%0a%3cp%3eWe%20also%20let%20the%20compiler%20know%20that%20we%20want%20to%20use%20the%20variable%20%3ccode%3ea%3c%2fcode%3e%20for%20the%20entire%20scope%20of%20%3ccode%3emain%3c%2fcode%3e%2c%20rather%20than%20just%20inside%20the%20nested%20scope.%3c%2fp%3e%0a%3cp%3eIn%20most%20languages%2c%20this%20would%20work%20just%20fine.%20The%20garbage%20collector%20would%20see%20that%20we%26rsquo%3bve%20made%20another%20reference%20to%20the%20string%2c%20and%20it%20would%20keep%20it%20alive%20for%20the%20remainder%20of%20the%20function.%3c%2fp%3e%0a%3cp%3eBut%20Rust%20will%20complain.%3c%2fp%3e%0a%3cpre%20tabindex%3d%220%22%3e%3ccode%3eerror%5bE0597%5d%3a%20%60value%60%20does%20not%20live%20long%20enough%0a%20%20--%26gt%3b%20%26lt%3bsource%26gt%3b%3a37%3a7%0a%20%20%20%7c%0a37%20%7c%20%20%20%20%20%20%20%20%20a%20%3d%20%26amp%3bvalue%3b%0a%20%20%20%7c%20%20%20%20%20%20%20%20%20%20%20%20%20%5e%5e%5e%5e%5e%5e%20borrowed%20value%20does%20not%20live%20long%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enough%0a38%20%7c%20%20%20%20%20%7d%0a%20%20%20%7c%20%20%20%20%20-%20%60value%60%20dropped%20here%20while%20still%20borrowed%0a39%20%7c%0a40%20%7c%20%20%20%20%20println%21%28%26%2334%3b%7b%7d%26%2334%3b%2c%20a%29%3b%0a%20%20%20%7c%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20borrow%20later%20used%20here%0a%3c%2fcode%3e%3c%2fpre%3e%3cp%3eIt%20knows%20that%20we%20are%20assigning%20%3ccode%3ea%3c%2fcode%3e%20to%20the%20borrowed%20%3ccode%3evalue%3c%2fcode%3e%2c%20and%20since%20%3ccode%3evalue%3c%2fcode%3e%20doesn%26rsquo%3bt%20live%20beyond%20the%20nested%20scope%2c%20when%20we%20try%20use%20%3ccode%3ea%3c%2fcode%3e%20on%20the%20last%20line%2c%20we%20get%20a%20compile%20time%20error.%3c%2fp%3e%0a%3ch2%20id%3d%22rusts-major-innovation%22%3eRust%26rsquo%3bs%20major%20innovation%3c%2fh2%3e%0a%3cblockquote%3e%0a%3cp%3eIt%20is%20a%20combination%20of%20tracking%20the%20ownership%20of%20data%2c%20and%20how%20long%20that%20data%20lives%20%26ldquo%3b%3cstrong%3e%3cem%3eat%20compile%20time%3c%2fem%3e%3c%2fstrong%3e%26rdquo%3b.%3c%2fp%3e%0a%3c%2fblockquote%3e%0a%3cp%3eThis%20is%20Rust%26rsquo%3bs%20major%20innovation.%3c%2fp%3e%0a%3ch2%20id%3d%22so-what%22%3eSo%20what%3f%3c%2fh2%3e%0a%3cp%3e%26ldquo%3bSo%20what%3f%26rdquo%3b%20you%20say.%3c%2fp%3e%0a%3cp%3eBeing%20able%20to%20do%20this%20at%20compile%20time%20means%20that%20Rust%20doesn%26rsquo%3bt%20need%20to%20add%20any%20additional%20CPU%20instructions%20to%20manage%20this%20memory.%20Yet%2c%20you%20as%20a%20programmer%20still%20have%20complete%20control%20over%20when%20and%20where%20memory%20is%20both%20allocated%20and%20freed.%3c%2fp%3e%0a%3cp%3eHistorically%20you%20needed%20a%20garbage%20collector%20for%20this%20kind%20of%20freedom%2c%20but%20as%20covered%20earlier%20in%20the%20article%2c%20those%20come%20with%20a%20runtime%20complexity%20and%20performance%20cost.%20Rust%20asks%20for%20neither.%3c%2fp%3e%0a%3cp%3eIt%20does%20have%20a%20cost%20though.%3c%2fp%3e%0a%3cp%3eIt%20comes%20in%20the%20form%20of%20shifting%20a%20bit%20of%20that%20complexity%20back%20onto%20the%20programmer.%20In%20most%20situations%20the%20compiler%20can%20infer%20what%20you%20need%2c%20but%20in%20a%20few%20it%20cannot%2c%20and%20when%20that%20happens%20you%26rsquo%3bll%20need%20to%20step%20in%20and%20help%20it%20out%20by%20providing%20extra%20information%2c%20or%20by%20altering%20your%20code.%3c%2fp%3e%0a%3cp%3eIt%20is%20important%20to%20note%20that%20this%20complexity%20does%20decrease%20over%20time.%20Eventually%20you%26rsquo%3bll%20get%20use%20to%20its%20idiosyncrasies%20and%20you%26rsquo%3bll%20likely%20be%20back%20to%20being%20as%20productive%20as%20you%20were%20with%20any%20other%20language.%20With%20the%20added%20benefit%20of%20the%20borrow%20checker%20helping%20you%20to%20identify%20bugs%20that%20you%20might%20not%20have%20otherwise%20found%20until%20runtime%2c%20if%20at%20all.%3c%2fp%3e%0a%3ch2%20id%3d%22do-i-recommend-rust%22%3eDo%20I%20recommend%20Rust%3f%3c%2fh2%3e%0a%3cp%3eSo%20that%26rsquo%3bs%20it.%20That%20is%20mostly%20what%20I%20wanted%20to%20cover%20here%2c%20but%20that%20leaves%20one%20big%20question.%3c%2fp%3e%0a%3cp%3eWould%20I%20recommend%20Rust%3f%3c%2fp%3e%0a%3cp%3eRust%20is%20possibly%20my%20most%20used%20language%20on%20hobby%20projects%2c%20and%20has%20been%20since%20around%202015%20when%20I%20first%20started%20following%20its%20progress.%20It%20is%20one%20of%20about%20three%20languages%20I%20usually%20pick%20from%20when%20starting%20a%20new%20project.%20%28Rust%2c%20C%20and%20Zig%29%3c%2fp%3e%0a%3cp%3eBut%20do%20I%20recommend%20it%3f%20I%26rsquo%3bm%20not%20completely%20sure.%3c%2fp%3e%0a%3cp%3eEven%20though%20Rust%20does%20make%20some%20amazing%20guarantees%20at%20compile%20time%2c%20there%20is%20something%20about%20it%20that%20always%20bugs%20me%20whenever%20I%20use%20it.%20I%20tend%20to%20find%20myself%20constantly%20solving%20%26ldquo%3bRust%26rdquo%3b%20problems%2c%20rather%20than%20my%20actual%20problems.%20Even%20small%20distractions%20of%20this%20nature%20can%20take%20you%20completely%20out%20of%20the%20flow%2c%20even%20if%20you%20know%20what%20you%26rsquo%3bre%20trying%20to%20do%20is%20technically%20safe.%3c%2fp%3e%0a%3cp%3eThis%20is%20because%20what%20Rust%20considers%20safe%2c%20does%20not%20necessarily%20encompass%20all%20possible%20safe%20programs.%20Instead%20it%20can%20only%20cover%20a%20subset.%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22%2fwhy_i_find_rust_interesting%2fsafe-code.png%22%20alt%3d%22Safe%20code%22%3e%3c%2fp%3e%0a%3cp%3eFor%20the%20rest%2c%20Rust%20will%20need%20you%20to%20alter%20your%20solution%2c%20or%20at%20least%20annotate%20it%20in%20such%20a%20way%20that%20it%20understands%20what%20you%26rsquo%3bre%20trying%20to%20do.%20And%20it%20is%20this%20extra%20bit%20of%20effort%20that%20causes%20me%20some%20frustration.%3c%2fp%3e%0a%3cp%3eHaving%20said%20that%20though%2c%20I%20do%20think%20that%20Rust%20will%20likely%20play%20a%20major%20role%20in%20the%20commercial%20landscape%20in%20the%20future.%20Especially%20in%20areas%20where%20performance%20matters.%20Perhaps%20eating%20a%20lot%20of%20the%20roles%20that%20C%2b%2b%2c%20Java%20or%20C%23%20would%20have%20otherwise%20been%20a%20natural%20fit%20for.%20There%20are%20already%20a%20number%20of%20large%20companies%20using%20it%20for%20some%20of%20their%20new%20projects.%20%26ldquo%3bSafety%26rdquo%3b%20is%20an%20extremely%20marketable%20feature%2c%20and%20often%20that%20is%20enough%2c%20even%20without%20the%20performance%20gains.%3c%2fp%3e%0a%3cp%3eHowever%2c%20not%20everyone%20needs%20to%20constantly%20write%20%26ldquo%3bsafe%26rdquo%3b%20software%2c%20so%20on%20a%20personal%20level%2c%20I%20do%20find%20the%20added%20complexity%20Rust%20brings%20to%20occasionally%20spoil%20the%20fun.%20Especially%20when%20I%26rsquo%3bm%20just%20trying%20to%20prototype%20something.%3c%2fp%3e%0a%3cp%3eBut%20does%20Rust%20deserve%20some%20of%20your%20time%20at%20least%3f%20Absolutely%21%20It%20is%20one%20of%20the%20best%2c%20if%20not%20the%20best%20programming%20languages%20to%20come%20out%20in%20the%20last%20two%20decades.%20If%20nothing%20else%2c%20it%20will%20change%20the%20way%20you%20program%20in%20other%20languages%20in%20the%20future.%3c%2fp%3e%0a%3cp%3eFor%20me%20that%20is%20enough%20to%20consider%20it%20worth%20at%20least%20a%20bit%20of%20your%20time.%3c%2fp%3e%0a%3chr%3e%0a%3ch2%20id%3d%22references--links%22%3eReferences%20%26amp%3b%20Links%3c%2fh2%3e%0a%3cul%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2fsourceware.org%2fgit%2f%3fp%3dglibc.git%3ba%3dblob%3bf%3dmalloc%2fmalloc.c%3bh%3d76c50e3f581771d0d14552eb13b3d7bbd7d4b922%3bhb%3dHEAD%22%3eglibc%20malloc.c%20implementation%3c%2fa%3e%3c%2fli%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2frustc-dev-guide.rust-lang.org%22%3eRust%20Compiler%20Development%20Guide%3c%2fa%3e%3c%2fli%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2fcognitive-engineering-lab.github.io%2faquascope%2f%22%3eAquascope%3c%2fa%3e%3c%2fli%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2fwww.youtube.com%2fwatch%3fv%3d5C_HPTJg5ek%22%3eFireship%26rsquo%3bs%20Rust%20in%20100%20seconds%3c%2fa%3e%3c%2fli%3e%0a%3c%2ful%3e%0a" title="Share via Email" target="_blank"><span class="fa fa-envelope fa-2x" aria-hidden="true"></span></a>
</div>
    
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>&copy; 2022 | Follow on <a class="follow-item" href="https://twitter.com/shivernz" target="_blank">Twitter</a> | <a class="follow-item" href="https://github.com/shiver" target="_blank">GitHub</a></p>
  </div>
</section>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js" integrity="sha512-gU7kztaQEl7SHJyraPfZLQCNnrKdaQi5ndOyt4L4UPL/FHDd/uB9Je6KDARIqwnNNE27hnqoWLBq+Kpe4iHfeQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/c.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/cpp.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/csharp.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/rust.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/python.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/php.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/javascript.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/css.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/typescript.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146427172-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
